<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="point_of_sale.OrderReceipt" t-inherit="point_of_sale.OrderReceipt" t-inherit-mode="extension">

    
        <!-- Agregar atributo data para aplicar estilos condicionalmente -->
        <xpath expr="//div[@class='pos-receipt p-2']" position="attributes">
            <attribute name="t-att-data-custom-receipt">order.config.use_custom_receipt</attribute>
        </xpath>

        <!-- Personalización del pie del recibo -->
        <xpath expr="//div[@class='text-start']" position="inside">
            <t t-if="order.config.use_custom_receipt">
                <div class="custom-receipt-footer text-center">
                    <div class="fw-bold mb-2">¡GRACIAS POR SU COMPRA!</div>
                </div>
            </t>
        </xpath>

        <xpath expr="//div[@class='before-footer']" position="replace">
            <span></span>
        </xpath>

        <!-- Ocultar la información de la empresa en el footer cuando está personalizado -->
        <xpath expr="//div[@class='d-flex gap-2 pt-3']" position="attributes">
            <attribute name="t-if">!order.config.use_custom_receipt</attribute>
        </xpath>

        <!-- Información de facturación electrónica (QR y CUFE) -->
        <xpath expr="//div[@class='pos-receipt-order-data text-center pt-3']" position="before">
            <t t-if="order.config.use_custom_receipt and order.account_move and order.account_move.l10n_co_edi_cufe_cude_ref and order.company.country_id and order.company.country_id.code == 'CO'">
                <div class="electronic-invoice-info text-center pt-3">

                    <!-- Información adicional -->
                    <t t-if="order.account_move.name">
                        <div class="electronic-info-footer">
                            <div><span class="fw-bold">Factura Electrónica:</span> <span t-esc="order.account_move.name"/></div>
                        </div>
                    </t>

                    <!-- Información del CUFE -->
                    <div class="cufe-info">
                        <div class="fw-bold">CUFE:</div>
                        <div class="cufe-value" t-esc="order.account_move.l10n_co_edi_cufe_cude_ref"/>
                    </div>

                    <!-- Código QR de facturación electrónica -->
                    <t t-if="order.account_move.l10n_co_dian_state == 'invoice_accepted' and order.account_move.pos_qr_barcode_src">
                        <div class="qr-code-section text-center mb-3">
                            <div class="qr-code-container">
                                <img class="qr-code-image" 
                                     t-att-src="order.account_move.pos_qr_barcode_src"
                                     alt="Código QR Factura Electrónica"/>
                            </div>
                        </div>
                    </t>
                </div>
            </t>
        </xpath>

        <!-- Reemplazar el texto "Powered by Odoo" con contenido personalizado -->
        <xpath expr="//div[@class='pos-receipt-order-data text-center pt-3']" position="replace">
            <div class="pos-receipt-order-data text-center pt-3">
                <t t-if="order.config.use_custom_receipt and order.config.custom_receipt_footer">
                    <div class="footer-tiem">
                        <t t-out="order.config.custom_receipt_footer"/>
                    </div>
                    <div class="footer-tiem">
                        <span>Industrias Bicicletas Milán S.A.</span>
                        <span t-if="order.company.website">Web: <span t-esc="order.company.website"/></span>
                    </div>
                    <div class="footer-tiem">
                        <span>Fabricante de software Odoo © - 2025</span>
                    </div>
                </t>
            </div>
        </xpath>
    </t>
</templates>