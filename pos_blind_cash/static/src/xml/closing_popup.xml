<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-inherit="point_of_sale.ClosePosPopup" t-inherit-mode="extension">
        
        <!-- Deshabilitar el campo de entrada manual de efectivo cuando se fuerza el uso de denominaciones -->
        <xpath expr="//div[@t-if='pos.config.cash_control' and hasclass('mb-3')]//Input" position="attributes">
            <attribute name="readonly">pos.config.force_cash_denomination_usage</attribute>
        </xpath>

        <!-- Ocultar el div de total de órdenes en el header -->
        <xpath expr="//t[@t-set-slot='header']//div[@class='total-orders fw-bolder align-middle my-1']" position="attributes">
            <attribute name="t-if">!pos.config.hide_closing_summary</attribute>
        </xpath>
        
        <!-- Ocultar el contenido interno de payment-methods-overview -->
        <xpath expr="//div[@class='payment-methods-overview']/div[@t-if='pos.config.cash_control']" position="replace">
            <div t-if="pos.config.cash_control and !pos.config.hide_closing_summary" class="w-100 mb-3">
                <t t-set="diff" t-value="getDifference(props.default_cash_details.id)" />
                <t t-set="counted" t-value="state.payments[props.default_cash_details.id]?.counted || '0'" />
                <div class="d-flex align-items-center justify-content-between fs-3">
                    <span t-esc="props.default_cash_details.name" />
                    <span t-esc="env.utils.formatCurrency(props.default_cash_details.amount)" />
                </div>
                <div class="d-flex align-items-center justify-content-between text-muted border-start ps-2">
                    <span>Opening</span>
                    <span t-esc="env.utils.formatCurrency(props.default_cash_details.opening)" />
                </div>
                <div t-if="props.default_cash_details.payment_amount" class="d-flex align-items-center justify-content-between text-muted border-start ps-2">
                    <span>Payments in <t t-esc="props.default_cash_details.name"/></span>
                    <span class="align-top" t-esc="env.utils.formatCurrency(Math.abs(props.default_cash_details.payment_amount))"/>
                </div>
                <t t-set="moveData" t-value="cashMoveData"/>
                <PaymentMethodBreakdown title.translate="Cash In / Out" total_amount="cashMoveData.total" transactions="cashMoveData.moves"/>
                <div class="d-flex align-items-center justify-content-between text-muted border-start ps-2">
                    <span>Counted</span>
                    <span t-esc="env.utils.formatCurrency(env.utils.parseValidFloat(counted))" />
                </div>
                <div class="d-flex align-items-center justify-content-between text-muted border-start ps-2" t-att-class="{'text-danger fw-bold': diff}">
                    <span>Difference</span>
                    <span class="cash-difference" t-esc="env.utils.formatCurrency(diff)" />
                </div>
            </div>
        </xpath>

        <!-- Ocultar el segundo div dentro de payment-methods-overview (métodos de pago no cash) -->
        <xpath expr="//div[@class='payment-methods-overview']/div[@t-foreach='props.non_cash_payment_methods']" position="attributes">
            <attribute name="t-if">!pos.config.hide_closing_summary</attribute>
        </xpath>

        <!-- Ocultar el separador hr si el resumen está oculto -->
        <xpath expr="//hr" position="attributes">
            <attribute name="t-if">!pos.config.hide_closing_summary</attribute>
        </xpath>

        <!-- Ocultar el botón de autocompletar efectivo si el resumen está oculto -->
        <xpath expr="//button[@t-on-click='autoFillCashCount']" position="attributes">
            <attribute name="t-if">!pos.config.hide_closing_summary</attribute>
        </xpath>

        <!-- Ocultar el botón de Daily Sale si el resumen está oculto -->
        <xpath expr="//button[@t-on-click='downloadSalesReport']" position="attributes">
            <attribute name="t-if">!pos.config.hide_closing_summary</attribute>
        </xpath>

    </t>
</templates>
