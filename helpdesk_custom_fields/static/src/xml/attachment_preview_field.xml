<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="helpdesk_custom_fields.AttachmentPreviewField">
        <div class="helpdesk_attachment_preview_field">
            <!-- Área de subida de archivos -->
            <div class="helpdesk_attachment_upload_area mb-3" t-if="!props.readonly">
                <FileInput
                    className="'btn btn-primary'"
                    accepted="'*/*'"
                    onUpload.bind="onFileUploaded"
                    multiUpload="true"
                    resModel="resModel"
                    resId="resId"
                >
                    <i class="fa fa-upload me-2"/>
                    <t t-out="uploadText or 'Subir archivos'"/>
                </FileInput>
            </div>

            <!-- Lista de archivos -->
            <div class="helpdesk_attachment_list" t-if="files.length > 0">
                <div class="helpdesk_attachment_grid">
                    <t t-foreach="files" t-as="file" t-key="file.id">
                        <div class="helpdesk_attachment_grid_item">
                            <div class="helpdesk_attachment_card">
                                <div class="helpdesk_attachment_preview" 
                                     t-att-class="file.isViewable ? 'cursor-pointer' : ''"
                                     t-on-click="() => this.onFileClick(file)">
                                    
                                    <t t-if="file.isImage">
                                        <div class="helpdesk_attachment_image_wrapper">
                                            <img t-att-src="'/web/image/' + file.id + '?height=200'" 
                                                 t-att-alt="file.name"/>
                                        </div>
                                    </t>
                                    <t t-else="">
                                        <div class="helpdesk_attachment_icon_wrapper">
                                            <i t-att-class="'fa fa-5x ' + getFileIcon(file.mimetype)"/>
                                        </div>
                                    </t>
                                    
                                    <t t-if="file.isViewable">
                                        <div class="helpdesk_attachment_badge">
                                            <span class="helpdesk_attachment_badge_content">
                                                <i class="fa fa-eye"/>Vista previa
                                            </span>
                                        </div>
                                    </t>
                                </div>

                                <!-- Información del archivo -->
                                <div class="helpdesk_attachment_body">
                                    <div class="helpdesk_attachment_info">
                                        <div class="helpdesk_attachment_name" 
                                             t-att-title="file.name">
                                            <t t-out="getNameWithoutExtension(file)"/>
                                        </div>
                                        <div class="helpdesk_attachment_details">
                                            <span class="helpdesk_attachment_extension" t-out="getExtension(file)"/>
                                        </div>
                                        <div class="helpdesk_attachment_meta">
                                            <div t-if="getUserName(file)" class="helpdesk_attachment_meta_item">
                                                <i class="fa fa-user"/>
                                                <t t-out="getUserName(file)"/>
                                            </div>
                                            <div t-if="getFormattedDate(file)" class="helpdesk_attachment_meta_item">
                                                <i class="fa fa-clock-o"/>
                                                <t t-out="getFormattedDate(file)"/>
                                            </div>
                                        </div>
                                        
                                        <div class="helpdesk_attachment_warranty_check" t-if="!props.readonly">
                                            <label class="helpdesk_attachment_warranty_label" t-att-class="{'disabled': file.isDisabled}">
                                                <input type="checkbox" 
                                                       t-att-checked="file.is_warranty_certificate"
                                                       t-att-disabled="file.isDisabled"
                                                       t-on-click.stop="() => this.onWarrantyCertificateToggle(file.id, file.is_warranty_certificate)"
                                                       class="helpdesk_attachment_warranty_checkbox"/>
                                                <span class="helpdesk_attachment_warranty_text">
                                                    <i class="fa fa-certificate me-1"/>
                                                    Acta de garantía
                                                </span>
                                            </label>
                                        </div>
                                        
                                        <div class="helpdesk_attachment_warranty_badge" t-if="props.readonly and file.is_warranty_certificate">
                                            <span class="badge bg-success">
                                                <i class="fa fa-certificate me-1"/>
                                                Acta de garantía
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Acciones -->
                                <div class="helpdesk_attachment_actions">
                                    <a t-att-href="file.downloadUrl" 
                                       class="helpdesk_attachment_action_btn"
                                       title="Descargar"
                                       download="">
                                        <i class="fa fa-download"/>
                                    </a>
                                    <button t-if="!props.readonly"
                                            type="button"
                                            class="helpdesk_attachment_action_btn helpdesk_attachment_action_btn_edit"
                                            t-on-click.stop="() => this.onFileRename(file.id, file.name)"
                                            title="Renombrar">
                                        <i class="fa fa-pencil"/>
                                    </button>
                                    <button t-if="!props.readonly"
                                            type="button"
                                            class="helpdesk_attachment_action_btn helpdesk_attachment_action_btn_delete"
                                            t-on-click.stop="() => this.onFileRemove(file.id)"
                                            title="Eliminar">
                                        <i class="fa fa-trash"/>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </div>

            <!-- Mensaje cuando no hay archivos -->
            <div t-else="" class="helpdesk_attachment_empty">
                <i class="fa fa-info-circle"/>
                No hay archivos adjuntos
            </div>
        </div>
    </t>

</templates>

