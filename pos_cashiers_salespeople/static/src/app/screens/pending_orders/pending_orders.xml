<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="pos_cashiers_salespeople.PendingOrdersScreen">
        <div class="pending-orders-screen screen h-100 bg-100">
            <div class="screen-full-width d-flex w-100 h-100">
                <!-- Panel izquierdo - Lista de pedidos pendientes -->
                <div class="leftpane pane-border d-flex flex-column w-50 h-100 bg-view border-end overflow-y-auto">
                    <div class="controls d-grid d-sm-flex align-items-center justify-content-between gap-2 gap-sm-3 p-2">
                        <div class="buttons d-flex gap-1">
                            <h3 class="mb-0 d-flex align-items-center">
                                <i class="fa fa-clock-o me-2"></i>
                                Pedidos Pendientes
                            </h3>
                        </div>
                        <div class="buttons d-flex gap-1">
                            <button class="btn btn-primary" t-on-click="() => this.refreshOrders()">
                                <i class="fa fa-refresh me-1"></i>
                                Actualizar
                            </button>
                        </div>
                    </div>
                    <div class="content flex-grow-1 p-3">
                        <div t-if="state.loading" class="text-center mt-5">
                            <i class="fa fa-spinner fa-spin fa-3x text-primary"></i>
                            <p class="mt-3">Cargando pedidos...</p>
                        </div>
                        <div t-elif="!pendingOrders.length" class="text-center mt-5">
                            <div class="text-muted">
                                <i class="fa fa-clock-o fa-3x"></i>
                                <p class="mt-3">No hay pedidos pendientes</p>
                            </div>
                        </div>
                        <div t-else="" class="pending-orders-list">
                            <t t-foreach="pendingOrders" t-as="order" t-key="order.id">
                                <div class="order-card p-3 mb-3 border rounded cursor-pointer"
                                     t-attf-class="{{ selectedOrder and selectedOrder.id === order.id ? 'border-primary bg-light' : 'border-secondary' }}"
                                     t-on-click="() => this.selectOrder(order)">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="flex-grow-1">
                                            <h5 class="mb-1 text-primary">
                                                <i class="fa fa-file-text-o me-2"></i>
                                                <t t-esc="order.name"/>
                                            </h5>
                                            <p class="mb-1 text-muted small">
                                                <i class="fa fa-user me-1"></i>
                                                Vendedor: <t t-esc="order.salesperson_name"/>
                                            </p>
                                            <p class="mb-1 text-muted small">
                                                <i class="fa fa-user-o me-1"></i>
                                                Cliente: <t t-esc="order.partner_name"/>
                                            </p>
                                            <p class="mb-1 text-muted small">
                                                <i class="fa fa-calendar me-1"></i>
                                                <t t-esc="order.formatted_date"/>
                                            </p>
                                        </div>
                                        <div class="text-end">
                                            <h4 class="mb-0 text-success">
                                                $<t t-esc="order.amount_total.toFixed(2)"/>
                                            </h4>
                                            <small class="text-muted">
                                                <t t-esc="order.orderLinesData.length"/> productos
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </div>
                    </div>
                </div>
                
                <!-- Panel derecho - Detalle de la orden seleccionada -->
                <div class="rightpane pane-border d-flex flex-column w-50 h-100 bg-view overflow-y-auto">
                    <div class="controls d-grid d-sm-flex align-items-center justify-content-between gap-2 gap-sm-3 p-2 bg-view">
                        <div class="buttons d-flex gap-1">
                            <h3 class="mb-0 d-flex align-items-center">
                                <i class="fa fa-info-circle me-2"></i>
                                Detalle de la Orden
                            </h3>
                        </div>
                    </div>
                    <div class="content flex-grow-1 p-3">
                        <div t-if="!selectedOrder" class="text-center mt-5">
                            <div class="text-muted">
                                <i class="fa fa-hand-pointer-o fa-3x"></i>
                                <p class="mt-3">Selecciona una orden para ver los detalles</p>
                            </div>
                        </div>
                        <div t-else="" class="order-details">
                            <!-- Información general de la orden -->
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h5 class="mb-0">
                                        <i class="fa fa-file-text-o me-2"></i>
                                        <t t-esc="selectedOrder.name"/>
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-6">
                                            <p><strong>Vendedor:</strong> <t t-esc="selectedOrder.salesperson_name"/></p>
                                            <p><strong>Cliente:</strong> <t t-esc="selectedOrder.partner_name"/></p>
                                        </div>
                                        <div class="col-6">
                                            <p><strong>Fecha:</strong> <t t-esc="selectedOrder.formatted_date"/></p>
                                            <p><strong>Referencia:</strong> <t t-esc="selectedOrder.pos_reference || 'N/A'"/></p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Líneas de productos -->
                            <div class="card mb-3">
                                <div class="card-header bg-secondary text-white">
                                    <h6 class="mb-0">
                                        <i class="fa fa-shopping-cart me-2"></i>
                                        Productos
                                    </h6>
                                </div>
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table table-striped mb-0">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>Producto</th>
                                                    <th class="text-center">Cant.</th>
                                                    <th class="text-end">Precio</th>
                                                    <th class="text-end">Desc.</th>
                                                    <th class="text-end">Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-foreach="selectedOrder.orderLinesData" t-as="line" t-key="line_index">
                                                    <tr>
                                                        <td><t t-esc="line.product_name"/></td>
                                                        <td class="text-center"><t t-esc="line.quantity"/></td>
                                                        <td class="text-end">$<t t-esc="line.price_unit.toFixed(2)"/></td>
                                                        <td class="text-end"><t t-esc="line.discount"/>%</td>
                                                        <td class="text-end">$<t t-esc="line.subtotal.toFixed(2)"/></td>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Totales -->
                            <div class="card mb-3">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-6 offset-6">
                                            <div class="d-flex justify-content-between">
                                                <span>Subtotal:</span>
                                                <span>$<t t-esc="selectedOrder.amount_untaxed.toFixed(2)"/></span>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <span>Impuestos:</span>
                                                <span>$<t t-esc="selectedOrder.amount_tax.toFixed(2)"/></span>
                                            </div>
                                            <hr/>
                                            <div class="d-flex justify-content-between">
                                                <strong>Total:</strong>
                                                <strong class="text-success">$<t t-esc="selectedOrder.amount_total.toFixed(2)"/></strong>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Botón para cargar la orden al POS -->
                            <div class="text-center">
                                <button class="btn btn-success btn-lg" t-on-click="() => this.loadOrderToPos(selectedOrder)">
                                    <i class="fa fa-arrow-right me-2"></i>
                                    Cargar Orden al POS para Pago
                                </button>
                            </div>

                            <!-- Notas si existen -->
                            <div t-if="selectedOrder.note" class="card mt-3">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fa fa-sticky-note me-2"></i>
                                        Notas
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <p class="mb-0"><t t-esc="selectedOrder.note"/></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </t>
</templates>