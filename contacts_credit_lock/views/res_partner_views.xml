<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Campos para el bloqueo por cartera en el formulario de contacto -->
    <record id="view_partner_form_portfolio_block" model="ir.ui.view">
        <field name="name">res.partner.form.portfolio.block</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <xpath expr="//page[@name='sales_purchases']//group[@name='sale']" position="after">
                <field name="can_user_block_portfolio" invisible="1"/>
                
                <group name="portfolio_block" 
                       string="Bloqueo por Cartera"
                       invisible="not can_user_block_portfolio">
                    <field name="portfolio_blocked" widget="boolean_toggle"/>
                    <field name="portfolio_block_reason" 
                           invisible="not portfolio_blocked"
                           placeholder="Especifique la razÃ³n por la cual este contacto estÃ¡ bloqueado."/>
                </group>
            </xpath>
        </field>
    </record>

    <!-- Filtro para buscar contactos bloqueados por cartera en la vista de lista -->
    <record id="view_partner_search_portfolio_block" model="ir.ui.view">
        <field name="name">res.partner.search.portfolio.block</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_res_partner_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='inactive']" position="after">
                <separator/>
                <filter name="portfolio_blocked" 
                        string="Bloqueo por Cartera" 
                        domain="[('portfolio_blocked', '=', True)]"
                        help="Contactos bloqueados por problemas de cartera"/>
            </xpath>
        </field>
    </record>

    <!-- Campo para visualizar el estado de bloqueo en la vista de lista -->
    <record id="view_partner_tree_portfolio_block" model="ir.ui.view">
        <field name="name">res.partner.tree.portfolio.block</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='phone']" position="after">
                <field name="portfolio_blocked" 
                       widget="boolean_toggle" 
                       optional="hide"/>
            </xpath>
        </field>
    </record>
</odoo>

